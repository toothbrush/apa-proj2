ATTR TyScheme Ty Constraint RhsConstr TyEnv AnnEnv
  [||
      -- | Unrolls a type, and returns all the variables
      -- which are in "forall". This is useful for instantiation,
      -- since these variables will need concrete values.
      fav USE {`DS.union`} {DS.empty} : {Set AnnVar}
      copy : SELF
  ]

SEM TyScheme
  | AnnSig lhs.fav = @ts.fav DS.\\ DS.singleton @a

{
class FreeAnnVars a where
  fav :: a -> Set AnnVar -- alias String

instance FreeAnnVars Ty where
  fav x = fav_Syn_Ty (wrap_Ty (sem_Ty x) Inh_Ty)

instance FreeAnnVars TyScheme where
  fav x = fav_Syn_TyScheme (wrap_TyScheme (sem_TyScheme x) Inh_TyScheme)

instance FreeAnnVars SAnn where
  fav s = s

instance FreeAnnVars Constraints where
  fav = DS.fold DS.union DS.empty . DS.map fav

instance FreeAnnVars Constraint where
  fav c = fav_Syn_Constraint (wrap_Constraint (sem_Constraint c) Inh_Constraint)

instance FreeAnnVars TyEnv where
  fav x = fav_Syn_TyEnv (wrap_TyEnv (sem_TyEnv x) Inh_TyEnv)

instance FreeAnnVars AnnEnv where
  fav x = fav_Syn_AnnEnv (wrap_AnnEnv (sem_AnnEnv x) Inh_AnnEnv)

}
